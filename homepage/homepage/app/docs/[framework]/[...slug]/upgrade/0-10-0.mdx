import { ContentByFramework, CodeGroup } from '@/components/forMdx'

export const metadata = { title: "Jazz 0.10.0 is out!" };

# Jazz 0.10.0 is out!

<h2 className="not-prose text-sm text-stone-600 dark:text-stone-400 mb-5 pb-2 border-b">
  11 February 2025
</h2>

<div>
  On Jazz 0.10.0 we have been focusing on enhancing the authentication to make it optional and more flexible.

  Now your users can play around with your app, even in local-only mode, before signing up.
  
  There are also some other minor improvements that will make your Jazz experience even better!

  <h3>What's new?</h3>
  Here is what's changed in this release:
  - [New authentication flow](/docs/upgrade/0-10-0#new-authentication-flow), redesigned to make Jazz easier to start with and be more flexible
  - [Local-only mode](/docs/upgrade/0-10-0#local-only-mode), now your users can play around with your app, even in local-only mode, before signing up
  - [Improvements on the loading APIs](/docs/upgrade/0-10-0#improved-loading-api), ensureLoaded now always returns a value and useCoState now returns null if the value is not found
  - [Jazz Workers on native WebSockets](/docs/upgrade/0-10-0#native-websocket-for-jazz-workers), improving the compatibility with a wider set of Javascript runtimes
  - Support for Node 14 dropped on cojson
  - Bugfix: Group.removeMember now returns a promise
</div>

<ContentByFramework framework="react">
  <h3 id="new-authentication-flow">New authentication flow</h3>
  <div>
    Until now authentication has been the first part to figure out when building a Jazz app, and this was a stumbling block for many.

    Now is no more required and setting up a Jazz app is as easy as writing this:
<CodeGroup>
{/* prettier-ignore */}
```tsx
import { JazzProvider } from "jazz-react";

ReactDOM.createRoot(document.getElementById("root")!).render(
    <JazzProvider
        auth={passkeyAuth} // removed  // *bin*
        peer="wss://cloud.jazz.tools/?key=you@example.com"  // moved into sync // *bin*
        sync={{ peer: "wss://cloud.jazz.tools/?key=you@example.com" }}  // *add*
    >
        <App />
    </JazzProvider>
);
```
</CodeGroup>

New users are initially authenticated as "anonymous" and you can you can sign them up with one of the Jazz providers.

Your auth code can now blend into your component tree:
<CodeGroup>
{/* prettier-ignore */}
```tsx
export function AuthModal({ open, onOpenChange }: AuthModalProps) {
  const [username, setUsername] = useState("");
  const [isSignUp, setIsSignUp] = useState(true);

  const auth = usePasskeyAuth({ // Must be inside the JazzProvider!
    appName: "My super-cool web app",
  });

  const handleViewChange = () => {
    setIsSignUp(!isSignUp);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (isSignUp) {
      await auth.signUp(username);
    } else {
      await auth.logIn();
    }
    onOpenChange(false);
  };
```
</CodeGroup>

When a user signs up with one of the providers we register the current anonymous account into it.

To check if the user has registered you can use the new `useIsAuthenticated` hook:
<CodeGroup>
{/* prettier-ignore */}
```tsx
export function AuthButton() {
  const isAuthenticated = useIsAuthenticated();
  const { logOut } = useAccount();
  const [isModalOpen, setIsModalOpen] = useState(false);

  function handleSignOut() {
    logOut();
    location.href = "/";
  }

  if (isAuthenticated) {
    return (
      <Button variant="outline" onClick={handleSignOut}>
        Sign out
      </Button>
    );
  }

  return (
    <>
      <Button onClick={() => setOpen(true)}>
        Sign up
      </Button>
      <AuthModal open={open} onOpenChange={setOpen} />
    </>
  );
}
```
</CodeGroup>

If you do want to require your users to register before using your app, you can do it by just moving the auth code inside the `JazzProvider` component like this:
<CodeGroup>
{/* prettier-ignore */}
```tsx
import { JazzProvider, PasskeyAuthBasicUI } from "jazz-react";

ReactDOM.createRoot(document.getElementById("root")!).render(
    <JazzProvider
      sync={{ peer: "wss://cloud.jazz.tools/?key=you@example.com" }}
    >
      <PasskeyAuthBasicUI appName="My super-fast web app">
        <App />
      </PasskeyAuthBasicUI>
    </JazzProvider>
);
```
</CodeGroup>

For the changes related to the specific auth providers see the updated [authentication docs](/docs/authentication).
  </div>
</ContentByFramework>

<h3 id="local-only-mode">Local-only mode</h3>
<div>
A great way to get you users to try your app for free is to make it local-only for anonymous users.

With `sync.when` set to `"signedUp"` the app will work in local mode when the user is anonymous and unlock the multiplayer features when they sign up:
<CodeGroup>
```ts
<JazzProvider
  sync={{
    peer: `wss://cloud.jazz.tools/?key=${apiKey}`,
     // This makes the app work in local mode when the user is anonymous
    when: "signedUp",
  }}
>
  <App />
</JazzProvider>
```
</CodeGroup>

You can control when Jazz will sync by switching the `when` config to `"always"` or `"never"`.
</div>

<h3 id="improved-loading-api">Improvements on the loading APIs</h3>
<div>
Before 0.10.0 `ensureLoaded` was returning a nullable value forcing the Typescript code to always include null checks:
<CodeGroup>
```ts
export async function updateActiveTrack(track: MusicTrack) { // No need to pass the account
  const me = await MusicaAccount.getMe().ensureLoaded({
    root: {},
  });

  if (!me) { //Techncally can never happen
    throw new Error("User not found");
  }

  me.root.activeTrack = track;
}
```
</CodeGroup>

Now `ensureLoaded` always returns a value, making it's usage leaner:
<CodeGroup>
```ts
export async function updateActiveTrack(track: MusicTrack) { // No need to pass the account
  const { root } = await MusicaAccount.getMe().ensureLoaded({
    root: {},
  });

  // Null checks are no more required
  root.activeTrack = track;
}
```
</CodeGroup>

It will throw if the value is not found, which can happen if the user tries to resolve a value that is not available.

`useCoState` now returns `null` if the value is not found, making it now possible to check against not-found values:
<CodeGroup>
```ts
const value = useCoState(MusicTrack, id, {});

if (value === null) {
  return <div>Track not found</div>;
}
```
</CodeGroup> 
</div>

<h3 id="native-websocket-for-jazz-workers">Jazz Workers on native WebSockets</h3>
<div>
  We have removed the dependency on `ws` and switched to the native WebSocket API for Jazz Workers.

  This improves the compatibility with a wider set of Javascript runtimes adding drop-in support for Deno, Bun, Browsers and Cloudflare Durable Objects.

  If you are using a Node.js version lower than 22 you will need to install the `ws` package and provide the WebSocket constructor:
  <CodeGroup>
```ts
import { WebSocket } from "ws";
import { startWorker } from "jazz-nodejs";

const { worker } = await startWorker({
  WebSocket,
});
```
</CodeGroup> 
</div>
