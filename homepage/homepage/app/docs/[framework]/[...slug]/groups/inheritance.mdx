import { ContentByFramework, CodeGroup } from '@/components/forMdx'

export const metadata = { title: "Group inheritance" };

# Group Inheritance

Groups can inherit members from other groups using the `extend` method. 

When a group extends another group, members of the parent group will become automatically part of the child group.

## Basic Usage

Here's how to extend a group:

<CodeGroup>
```typescript
const playlist = Group.create();
const track = Group.create();

// This way track becomes visible to the members of playlist
track.extend(playlist);
```
</CodeGroup>

When you extend a group:
- Members of the parent group get access to the child group
- Their roles are inherited (with some exceptions, see [below](#role-inheritance-rules))
- Removing a member from the parent group also removes their access to child groups

## Setting the extension role

You can set the extension role by passing a second argument to `extend`:

<CodeGroup>
```typescript
const organization = Group.create();

const billing = Group.create();

// This way the members of the organization can only read the billing data
billing.extend(organization, "reader"); 
```
</CodeGroup>

The extension role always overrides the role of the accounts in the parent group:

<CodeGroup>
```typescript
const parentGroup = Group.create();
parentGroup.addMember(bob, "reader");

const childGroup = Group.create();
childGroup.extend(parentGroup, "writer");

// Bob is now a writer in the child group
```
</CodeGroup>

## Multiple Levels of Inheritance

Groups can be extended multiple levels deep:

<CodeGroup>
```typescript
const grandParentGroup = Group.create();
const parentGroup = Group.create();
const childGroup = Group.create(); 

childGroup.extend(parentGroup);
parentGroup.extend(grandParentGroup);
```
</CodeGroup>

Members of the grandparent group will get access to all descendant groups based on their roles.

## Permission Changes

When you remove a member from a parent group, they automatically lose access to all child groups. We handle key rotation automatically to ensure security.

<CodeGroup>
```typescript
// Remove member from parent
await parentGroup.removeMember(bob);

// Bob loses access to both parent and child groups
```
</CodeGroup>

## Role Inheritance Rules

If the account is already a member of the child group, it will get the highest possible role:
<CodeGroup>
```typescript
const parentGroup = Group.create();
parentGroup.addMember(bob, "reader");

const childGroup = Group.create();
parentGroup.addMember(bob, "writer");
childGroup.extend(parentGroup);

// Bob stays a writer because his role is higher
// than the inherited reader role.
```
</CodeGroup>

When extending groups, only admin, writer and reader roles are inherited:
<CodeGroup>
```typescript
const parentGroup = Group.create();
parentGroup.addMember(bob, "writeOnly");

const childGroup = Group.create();
childGroup.extend(parentGroup);

// Bob does not become a member of the child group
```
</CodeGroup>

To extend a group:

1. The current account must be an admin in the child group
2. The current account must be a member of the parent group

<CodeGroup>
```typescript
const companyGroup = company._owner.castAs(Group)
const teamGroup = Group.create();

// Works only if I'm a member of companyGroup
teamGroup.extend(companyGroup); 
```
</CodeGroup>

## Example: Team Hierarchy

Here's a practical example of using group inheritance for team permissions:

<CodeGroup>
```typescript
// Company-wide group
const company = Group.create();
company.addMember(CEO, "admin");

// Team group with elevated permissions
const team = Group.create();
team.extend(company); // Inherits company-wide access
team.addMember(teamLead, "admin");
team.addMember(developer, "writer");

// Project group with specific permissions
const project = Group.create();
project.extend(team); // Inherits team permissions
project.addMember(client, "reader"); // Client can only read project items
```
</CodeGroup>

This creates a hierarchy where:
- The CEO has admin access to everything
- Team members get writer access to team and project content
- Team leads get admin access to team and project content
- The client can only read project content
